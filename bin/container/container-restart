#!/usr/bin/env bash
# Restart the Kubernetes deployment
#
# Usage:
#   container-restart                      # Restart opencode deployment in opencode namespace
#   container-restart myapp                # Restart myapp deployment in opencode namespace
#   container-restart myapp mynamespace    # Restart myapp deployment in mynamespace

set -euo pipefail

DEPLOYMENT="${1:-opencode}"
NAMESPACE="${2:-opencode}"

echo "Restarting deployment/$DEPLOYMENT in namespace $NAMESPACE..."
kubectl rollout restart "deployment/$DEPLOYMENT" -n "$NAMESPACE"

echo "Waiting for rollout to complete..."
kubectl rollout status "deployment/$DEPLOYMENT" -n "$NAMESPACE" --timeout=120s

echo "Restart complete."
